name: Invite New Contributor

on:
  issues:
    types: [opened, labeled]

jobs:
  invite:
    if: contains(github.event.issue.labels.*.name, 'new-contributor')
    runs-on: ubuntu-latest
    steps:
      - name: Invite Collaborator
        uses: actions/github-script@v7
        with:
          script: |
            const username = context.payload.issue.user.login;
            try {
              await github.rest.repos.addCollaborator({
                owner: context.repo.owner,
                repo: context.repo.repo,
                username: username,
                permission: 'write'
              });
              github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `Welcome @${username}! I've sent you an invitation to become a collaborator. Please check your email and accept it. Once accepted, you can submit your first PR by adding your name to CONTRIBUTORS.md.`
              });
            } catch (error) {
              github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body: `Sorry @${username}, there was an error inviting you: ${error.message}. Please contact the maintainers.`
              });
            }
